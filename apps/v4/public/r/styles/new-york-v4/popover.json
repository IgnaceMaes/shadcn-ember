{
  "$schema": "https://shadcn-ember.com/schema/registry-item.json",
  "name": "popover",
  "type": "registry:ui",
  "dependencies": [
    "@ember/modifier",
    "@floating-ui/dom",
    "@glimmer/component",
    "@glimmer/tracking",
    "ember-modifier",
    "ember-provide-consume-context"
  ],
  "files": [
    {
      "path": "registry/new-york-v4/ui/popover.gts",
      "content": "import { hash } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { htmlSafe } from '@ember/template';\nimport {\n  computePosition,\n  flip,\n  shift,\n  offset,\n  autoUpdate,\n  type Placement,\n} from '@floating-ui/dom';\nimport Component from '@glimmer/component';\nimport { tracked, cached } from '@glimmer/tracking';\nimport onClickOutside from 'ember-click-outside/modifiers/on-click-outside';\nimport { modifier } from 'ember-modifier';\nimport { provide, consume } from 'ember-provide-consume-context';\n\nimport { cn } from '@/lib/utils';\n\nimport type { TOC } from '@ember/component/template-only';\n\nconst PopoverContext = 'popover-context' as const;\n\ninterface PopoverContextValue {\n  open: boolean;\n  isRendered: boolean;\n  setOpen: (open: boolean) => void;\n  finishClose: () => void;\n  triggerElement: HTMLElement | null;\n  setTriggerElement: (element: HTMLElement | null) => void;\n}\n\ninterface ContextRegistry {\n  [PopoverContext]: PopoverContextValue;\n}\n\ninterface PopoverSignature {\n  Args: {\n    open?: boolean;\n    defaultOpen?: boolean;\n    onOpenChange?: (open: boolean) => void;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass Popover extends Component<PopoverSignature> {\n  @tracked isOpen?: boolean;\n  @tracked isOpenOrClosing = false;\n  triggerElement: HTMLElement | null = null;\n\n  get open() {\n    return this.args.open ?? this.isOpen ?? this.args.defaultOpen ?? false;\n  }\n\n  get isRendered() {\n    return this.open || this.isOpenOrClosing;\n  }\n\n  setOpen = (open: boolean) => {\n    if (open) {\n      this.isOpenOrClosing = true;\n      this.isOpen = true;\n    } else {\n      this.isOpen = false;\n    }\n    this.args.onOpenChange?.(open);\n  };\n\n  finishClose = () => {\n    if (!this.open) {\n      this.isOpenOrClosing = false;\n    }\n  };\n\n  setTriggerElement = (element: HTMLElement | null) => {\n    this.triggerElement = element;\n  };\n\n  @cached\n  @provide(PopoverContext)\n  get context(): PopoverContextValue {\n    return {\n      open: this.open,\n      isRendered: this.isRendered,\n      setOpen: this.setOpen,\n      finishClose: this.finishClose,\n      triggerElement: this.triggerElement,\n      setTriggerElement: this.setTriggerElement,\n    };\n  }\n\n  <template>\n    {{! template-lint-disable no-yield-only }}\n    {{yield}}\n  </template>\n}\n\ninterface PopoverTriggerSignatureAsChild {\n  Element: HTMLButtonElement;\n  Args: {\n    class?: string;\n    asChild: true;\n  };\n  Blocks: {\n    default: [\n      trigger: {\n        modifiers: typeof PopoverTrigger.prototype.applyTriggerBehavior;\n      },\n    ];\n  };\n}\n\ninterface PopoverTriggerSignatureAsRoot {\n  Element: HTMLButtonElement;\n  Args: {\n    class?: string;\n    asChild?: false;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\ntype PopoverTriggerSignature =\n  | PopoverTriggerSignatureAsChild\n  | PopoverTriggerSignatureAsRoot;\n\nclass PopoverTrigger extends Component<PopoverTriggerSignature> {\n  @consume(PopoverContext) context!: ContextRegistry[typeof PopoverContext];\n\n  handleClick = () => {\n    const newOpen = !this.context.open;\n    this.context.setOpen(newOpen);\n  };\n\n  registerElement = modifier((element: HTMLElement) => {\n    this.context.setTriggerElement(element);\n    return () => {\n      this.context.setTriggerElement(null);\n    };\n  });\n\n  applyTriggerBehavior = modifier((element: HTMLElement) => {\n    element.setAttribute('data-slot', 'popover-trigger');\n    element.addEventListener('click', this.handleClick);\n    this.context.setTriggerElement(element);\n    return () => {\n      element.removeEventListener('click', this.handleClick);\n      this.context.setTriggerElement(null);\n    };\n  });\n\n  <template>\n    {{#if @asChild}}\n      {{yield (hash modifiers=this.applyTriggerBehavior)}}\n    {{else}}\n      <button\n        class={{cn @class}}\n        data-slot=\"popover-trigger\"\n        type=\"button\"\n        {{on \"click\" this.handleClick}}\n        {{this.registerElement}}\n        ...attributes\n      >\n        {{yield}}\n      </button>\n    {{/if}}\n  </template>\n}\n\ninterface PopoverAnchorSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nconst PopoverAnchor: TOC<PopoverAnchorSignature> = <template>\n  <div class={{cn @class}} data-slot=\"popover-anchor\" ...attributes>\n    {{yield}}\n  </div>\n</template>;\n\ninterface PopoverContentSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n    align?: 'start' | 'center' | 'end';\n    side?: 'top' | 'right' | 'bottom' | 'left';\n    sideOffset?: number;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass PopoverContent extends Component<PopoverContentSignature> {\n  @consume(PopoverContext) context!: ContextRegistry[typeof PopoverContext];\n  @tracked x = 0;\n  @tracked y = 0;\n  cleanup?: () => void;\n\n  get destinationElement() {\n    return document.body;\n  }\n\n  handleClickOutside = () => {\n    this.context.setOpen(false);\n  };\n\n  positionContent = modifier((element: HTMLElement) => {\n    const triggerElement = this.context.triggerElement;\n    if (!triggerElement) return;\n\n    const align = this.args.align ?? 'center';\n    const side = this.args.side ?? 'bottom';\n    const placementMap: Record<string, Placement> = {\n      'top-start': 'top-start',\n      'top-center': 'top',\n      'top-end': 'top-end',\n      'right-start': 'right-start',\n      'right-center': 'right',\n      'right-end': 'right-end',\n      'bottom-start': 'bottom-start',\n      'bottom-center': 'bottom',\n      'bottom-end': 'bottom-end',\n      'left-start': 'left-start',\n      'left-center': 'left',\n      'left-end': 'left-end',\n    };\n\n    const placement =\n      placementMap[`${side}-${align}`] || ('bottom' as Placement);\n\n    const update = () => {\n      void computePosition(triggerElement, element, {\n        placement,\n        strategy: 'fixed',\n        middleware: [\n          offset(this.args.sideOffset ?? 4),\n          flip(),\n          shift({ padding: 8 }),\n        ],\n      }).then(({ x, y }) => {\n        this.x = x;\n        this.y = y;\n      });\n    };\n\n    this.cleanup = autoUpdate(triggerElement, element, update);\n\n    return () => {\n      this.cleanup?.();\n    };\n  });\n\n  handleAnimationEnd = (event: AnimationEvent) => {\n    if (event.target === event.currentTarget && !this.context.open) {\n      this.context.finishClose();\n    }\n  };\n\n  get positionStyle() {\n    return htmlSafe(\n      `position: fixed; left: ${this.x}px; top: ${this.y}px; z-index: 50;`\n    );\n  }\n\n  <template>\n    {{#if this.context.isRendered}}\n      {{#in-element this.destinationElement insertBefore=null}}\n        <div\n          class={{cn\n            \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden\"\n            @class\n          }}\n          data-align={{if @align @align \"center\"}}\n          data-side={{if @side @side \"bottom\"}}\n          data-slot=\"popover-content\"\n          data-state={{if this.context.open \"open\" \"closed\"}}\n          style={{this.positionStyle}}\n          {{on \"animationend\" this.handleAnimationEnd}}\n          {{onClickOutside this.handleClickOutside}}\n          {{this.positionContent}}\n          ...attributes\n        >\n          {{yield}}\n        </div>\n      {{/in-element}}\n    {{/if}}\n  </template>\n}\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };\n",
      "type": "registry:ui"
    }
  ]
}
