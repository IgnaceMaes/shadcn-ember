{
  "$schema": "https://shadcn-ember.com/schema/registry-item.json",
  "name": "command",
  "type": "registry:ui",
  "files": [
    {
      "path": "registry/new-york-v4/ui/command.gts",
      "content": "import { registerDestructor } from '@ember/destroyable';\nimport { on } from '@ember/modifier';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { modifier } from 'ember-modifier';\nimport { consume, provide } from 'ember-provide-consume-context';\nimport { TrackedArray } from 'tracked-built-ins';\n\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { cn } from '@/lib/utils';\n\nimport type { TOC } from '@ember/component/template-only';\n\nimport Search from '~icons/lucide/search';\n\nconst CommandContext = 'command-context' as const;\nconst CommandGroupContext = 'command-group-context' as const;\n\ninterface CommandItemData {\n  value: string;\n  keywords: string[];\n  isVisible: () => boolean;\n  isDisabled: () => boolean;\n}\n\ninterface CommandContextValue {\n  search: string;\n  setSearch: (value: string) => void;\n  selectedValue: string | null;\n  setSelectedValue: (value: string | null) => void;\n  allGroups: CommandGroupContextValue[];\n}\n\ninterface CommandGroupContextValue {\n  items: CommandItemData[];\n}\n\ninterface ContextRegistry {\n  [CommandContext]: CommandContextValue;\n  [CommandGroupContext]: CommandGroupContextValue;\n}\n\ninterface CommandRootSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass Command extends Component<CommandRootSignature> {\n  @tracked search = '';\n  @tracked selectedValue: string | null = null;\n  allGroups = new TrackedArray<CommandGroupContextValue>();\n\n  get firstVisibleItem(): string | null {\n    for (const group of this.allGroups) {\n      for (const item of group.items) {\n        if (item.isVisible() && !item.isDisabled()) {\n          return item.value;\n        }\n      }\n    }\n    return null;\n  }\n\n  setSearch = (value: string) => {\n    this.search = value;\n    requestAnimationFrame(() => {\n      this.selectedValue = this.firstVisibleItem;\n    });\n  };\n\n  setSelectedValue = (value: string | null) => {\n    this.selectedValue = value;\n  };\n\n  initializeSelection = modifier(() => {\n    requestAnimationFrame(() => {\n      this.selectedValue = this.firstVisibleItem;\n    });\n  });\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    const key = event.key;\n\n    if (key !== 'ArrowDown' && key !== 'ArrowUp' && key !== 'Enter') {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (key === 'Enter') {\n      const currentTarget = event.currentTarget as HTMLElement;\n      const selectedItem = currentTarget.querySelector<HTMLElement>(\n        '[data-slot=\"command-item\"][data-selected=\"true\"]'\n      );\n      selectedItem?.click();\n      return;\n    }\n\n    const currentTarget = event.currentTarget as HTMLElement;\n    const items = Array.from(\n      currentTarget.querySelectorAll<HTMLElement>(\n        '[data-slot=\"command-item\"]:not([hidden]):not([data-disabled=\"true\"])'\n      )\n    );\n\n    if (items.length === 0) return;\n\n    const currentIndex = items.findIndex(\n      (item) => item.getAttribute('data-selected') === 'true'\n    );\n\n    const newIndex =\n      key === 'ArrowDown'\n        ? currentIndex === -1\n          ? 0\n          : Math.min(currentIndex + 1, items.length - 1)\n        : currentIndex === -1\n          ? 0\n          : Math.max(currentIndex - 1, 0);\n\n    const newItem = items[newIndex];\n    const value = newItem?.getAttribute('data-value');\n\n    if (value && newItem) {\n      this.selectedValue = value;\n      newItem.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\n    }\n  };\n\n  @provide(CommandContext)\n  get context(): CommandContextValue {\n    return {\n      search: this.search,\n      setSearch: this.setSearch,\n      selectedValue: this.selectedValue,\n      setSelectedValue: this.setSelectedValue,\n      allGroups: this.allGroups,\n    };\n  }\n\n  <template>\n    <div\n      aria-controls=\"command-list\"\n      aria-expanded=\"true\"\n      class={{cn\n        \"bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md\"\n        @class\n      }}\n      data-slot=\"command\"\n      role=\"combobox\"\n      tabindex=\"0\"\n      {{on \"keydown\" this.handleKeyDown}}\n      {{this.initializeSelection}}\n      ...attributes\n    >\n      {{yield}}\n    </div>\n  </template>\n}\n\ninterface CommandDialogSignature {\n  Args: {\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n    title?: string;\n    description?: string;\n    class?: string;\n    showCloseButton?: boolean;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandDialog extends Component<CommandDialogSignature> {\n  get title() {\n    return this.args.title ?? 'Command Palette';\n  }\n\n  get description() {\n    return this.args.description ?? 'Search for a command to run...';\n  }\n\n  get showCloseButton() {\n    return this.args.showCloseButton ?? true;\n  }\n\n  <template>\n    <Dialog @onOpenChange={{@onOpenChange}} @open={{@open}}>\n      <DialogHeader class=\"sr-only\">\n        <DialogTitle>{{this.title}}</DialogTitle>\n        <DialogDescription>{{this.description}}</DialogDescription>\n      </DialogHeader>\n      <DialogContent\n        @class={{cn \"overflow-hidden p-0\" @class}}\n        @showCloseButton={{this.showCloseButton}}\n      >\n        <Command\n          @class=\"[&_[data-cmdk-group-heading]]:text-muted-foreground [&_[data-slot=command-input-wrapper]]:h-12 [&_[data-cmdk-group-heading]]:px-2 [&_[data-cmdk-group-heading]]:font-medium [&_[data-cmdk-group]]:px-2 [&_[data-cmdk-group]:not([hidden])_~[data-cmdk-group]]:pt-0 [&_[data-slot=command-input-wrapper]_svg]:h-5 [&_[data-slot=command-input-wrapper]_svg]:w-5 [&_[data-slot=command-input]]:h-12 [&_[data-slot=command-item]]:px-2 [&_[data-slot=command-item]]:py-3 [&_[data-slot=command-item]_svg]:h-5 [&_[data-slot=command-item]_svg]:w-5\"\n        >\n          {{yield}}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  </template>\n}\n\ninterface CommandInputSignature {\n  Element: HTMLInputElement;\n  Args: {\n    class?: string;\n    placeholder?: string;\n    inputClass?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandInput extends Component<CommandInputSignature> {\n  @consume(CommandContext) context!: ContextRegistry[typeof CommandContext];\n\n  handleInput = (event: Event) => {\n    const target = event.target as HTMLInputElement;\n    this.context.setSearch(target.value);\n  };\n\n  preventDropdownClose = (event: Event) => {\n    event.stopPropagation();\n  };\n\n  focusInput = modifier((element: HTMLInputElement) => {\n    const isInDialogOrPopover =\n      element.closest('[data-slot=\"dialog-content\"]') ||\n      element.closest('[data-slot=\"popover-content\"]') ||\n      element.closest('[data-slot=\"dropdown-menu-sub-content\"]');\n\n    if (isInDialogOrPopover) {\n      requestAnimationFrame(() => {\n        element.focus();\n      });\n    }\n  });\n\n  <template>\n    {{! template-lint-disable no-invalid-interactive no-pointer-down-event-binding }}\n    <div\n      class={{cn \"flex h-9 items-center gap-2 border-b px-3\" @class}}\n      data-slot=\"command-input-wrapper\"\n      role=\"search\"\n      {{on \"click\" this.preventDropdownClose}}\n      {{on \"mousedown\" this.preventDropdownClose}}\n    >\n      <Search class=\"size-4 shrink-0 opacity-50\" />\n      <input\n        class={{cn\n          \"placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50\"\n          @inputClass\n        }}\n        data-slot=\"command-input\"\n        placeholder={{@placeholder}}\n        type=\"text\"\n        value={{this.context.search}}\n        {{on \"input\" this.handleInput}}\n        {{this.focusInput}}\n        ...attributes\n      />\n    </div>\n  </template>\n}\n\ninterface CommandListSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nconst CommandList: TOC<CommandListSignature> = <template>\n  <div\n    class={{cn\n      \"max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto\"\n      @class\n    }}\n    data-slot=\"command-list\"\n    id=\"command-list\"\n    role=\"listbox\"\n    ...attributes\n  >\n    {{yield}}\n  </div>\n</template>;\n\ninterface CommandEmptySignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandEmpty extends Component<CommandEmptySignature> {\n  @consume(CommandContext) context!: ContextRegistry[typeof CommandContext];\n\n  get hasVisibleItems(): boolean {\n    return this.context.allGroups.some((group) =>\n      group.items.some((item) => item.isVisible())\n    );\n  }\n\n  <template>\n    {{#unless this.hasVisibleItems}}\n      <div\n        class={{cn \"py-6 text-center text-sm\" @class}}\n        data-slot=\"command-empty\"\n        ...attributes\n      >\n        {{yield}}\n      </div>\n    {{/unless}}\n  </template>\n}\n\ninterface CommandGroupSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n    heading?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandGroup extends Component<CommandGroupSignature> {\n  @consume(CommandContext)\n  declare commandContext?: ContextRegistry[typeof CommandContext];\n  items = new TrackedArray<CommandItemData>();\n\n  @provide(CommandGroupContext)\n  groupContext: CommandGroupContextValue = { items: this.items };\n\n  get hasVisibleItems(): boolean {\n    return this.items.some((item) => item.isVisible());\n  }\n\n  registerWithCommand = modifier(() => {\n    if (!this.commandContext) return;\n\n    this.commandContext.allGroups.push(this.groupContext);\n\n    registerDestructor(this, () => {\n      const index = this.commandContext!.allGroups.indexOf(this.groupContext);\n      if (index > -1) {\n        this.commandContext!.allGroups.splice(index, 1);\n      }\n    });\n  });\n\n  <template>\n    <div\n      class={{cn\n        \"text-foreground [&_[data-cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[data-cmdk-group-heading]]:px-2 [&_[data-cmdk-group-heading]]:py-1.5 [&_[data-cmdk-group-heading]]:text-xs [&_[data-cmdk-group-heading]]:font-medium\"\n        @class\n      }}\n      data-slot=\"command-group\"\n      hidden={{unless this.hasVisibleItems true}}\n      {{this.registerWithCommand}}\n      ...attributes\n    >\n      {{#if @heading}}\n        <div data-cmdk-group-heading>{{@heading}}</div>\n      {{/if}}\n      {{yield}}\n    </div>\n  </template>\n}\n\ninterface CommandSeparatorSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandSeparator extends Component<CommandSeparatorSignature> {\n  @consume(CommandContext) context!: ContextRegistry[typeof CommandContext];\n\n  get hasVisibleItems(): boolean {\n    return this.context.allGroups.some((group) =>\n      group.items.some((item) => item.isVisible())\n    );\n  }\n\n  <template>\n    {{#if this.hasVisibleItems}}\n      <div\n        class={{cn \"bg-border -mx-1 h-px\" @class}}\n        data-slot=\"command-separator\"\n        ...attributes\n      ></div>\n    {{/if}}\n  </template>\n}\n\ninterface CommandItemComponentSignature {\n  Element: HTMLDivElement;\n  Args: {\n    class?: string;\n    disabled?: boolean;\n    value: string;\n    keywords?: string[];\n    onSelect?: (value: string) => void;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass CommandItem extends Component<CommandItemComponentSignature> {\n  @consume(CommandContext) context!: ContextRegistry[typeof CommandContext];\n  @consume(CommandGroupContext)\n  declare groupContext?: ContextRegistry[typeof CommandGroupContext];\n\n  get isVisible(): boolean {\n    const search = this.context.search?.trim();\n    if (!search) return true;\n\n    const searchLower = search.toLowerCase();\n    const value = this.args.value.toLowerCase();\n    const keywords = this.args.keywords || [];\n\n    return (\n      value.includes(searchLower) ||\n      keywords.some((keyword) => keyword.toLowerCase().includes(searchLower))\n    );\n  }\n\n  get isSelected(): boolean {\n    return this.context.selectedValue === this.args.value;\n  }\n\n  registerWithGroup = modifier(() => {\n    if (!this.groupContext) return;\n\n    const item: CommandItemData = {\n      value: this.args.value,\n      keywords: this.args.keywords || [],\n      isVisible: () => this.isVisible,\n      isDisabled: () => this.args.disabled ?? false,\n    };\n\n    this.groupContext.items.push(item);\n\n    registerDestructor(this, () => {\n      const index = this.groupContext!.items.indexOf(item);\n      if (index > -1) {\n        this.groupContext!.items.splice(index, 1);\n      }\n    });\n  });\n\n  handleClick = () => {\n    if (!this.args.disabled && this.args.onSelect) {\n      this.args.onSelect(this.args.value);\n    }\n  };\n\n  handleMouseEnter = () => {\n    if (!this.args.disabled) {\n      this.context.setSelectedValue(this.args.value);\n    }\n  };\n\n  <template>\n    {{#if this.isVisible}}\n      <div\n        aria-selected={{if this.isSelected \"true\" \"false\"}}\n        class={{cn\n          \"data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\"\n          @class\n        }}\n        data-disabled={{if @disabled \"true\" \"false\"}}\n        data-selected={{if this.isSelected \"true\" \"false\"}}\n        data-slot=\"command-item\"\n        data-value={{@value}}\n        hidden={{unless this.isVisible true}}\n        role=\"option\"\n        {{on \"click\" this.handleClick}}\n        {{on \"mouseenter\" this.handleMouseEnter passive=true}}\n        {{this.registerWithGroup}}\n        ...attributes\n      >\n        {{yield}}\n      </div>\n    {{/if}}\n  </template>\n}\n\ninterface CommandShortcutSignature {\n  Element: HTMLSpanElement;\n  Args: {\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nconst CommandShortcut: TOC<CommandShortcutSignature> = <template>\n  <span\n    class={{cn \"text-muted-foreground ml-auto text-xs tracking-widest\" @class}}\n    data-slot=\"command-shortcut\"\n    ...attributes\n  >\n    {{yield}}\n  </span>\n</template>;\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n};\n",
      "type": "registry:ui"
    }
  ]
}
